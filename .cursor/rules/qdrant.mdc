---
description: Usage Rules for Qdrant and Vector DB
alwaysApply: false
---
# Qdrant ë° Vector DB ì‚¬ìš© ê·œì¹™

ì´ ë¬¸ì„œëŠ” `Qdrant`ë¥¼ LangChainê³¼ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ ì½”ë“œì˜ ì¢…ì†ì„±ì„ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ê°€ì´ë“œë¼ì¸ì„ ì œê³µí•©ë‹ˆë‹¤.

í•µì‹¬ ì›ì¹™ì€ **"ì´ ê¸°ëŠ¥ì´ ëŒ€ë¶€ë¶„ì˜ ë²¡í„° DBì— ê³µí†µì ì¸ê°€, ì•„ë‹ˆë©´ Qdrant ê³ ìœ ì˜ ê´€ë¦¬/ìµœì í™” ê¸°ëŠ¥ì¸ê°€?"** ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## 3ë‹¨ê³„ ì ‘ê·¼ë²• (3-Level Approach)

### Level 1: ì™„ì „ ì¶”ìƒí™” ê³„ì¸µ (Fully Abstracted Layer) ğŸ§©

- **ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?**: ë¬¸ì„œ ê²€ìƒ‰, ìœ ì‚¬ë„ ê¸°ë°˜ ì¡°íšŒ ë“± ì¼ë°˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§.
- **ë¬´ì—‡ì„ ì‚¬ìš©í•˜ë‚˜?**: `vector_store.as_retriever()`ê°€ ë°˜í™˜í•˜ëŠ” `VectorStoreRetriever`.
- **ì™œ?**: ì½”ë“œê°€ íŠ¹ì • ë²¡í„° DBì— ì¢…ì†ë˜ì§€ ì•Šì•„, ë‚˜ì¤‘ì— ë‹¤ë¥¸ DBë¡œ êµì²´í•˜ë”ë¼ë„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ê²ƒì´ ê°€ì¥ ê¶Œì¥ë˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

```python
# âœ… DO: Retrieverë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ì¢…ì†ì„± ìœ ì§€
retriever = vector_store.as_retriever(
  search_type="similarity",
  search_kwargs={
    "k": 5,
    "filter": Filter(
      must=[
        FieldCondition(key="metadata.user_id", match=MatchValue(value="some_user"))
      ]
    )
  }
)

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œëŠ” retrieverë§Œ ì‚¬ìš©
relevant_docs = retriever.invoke("ì‚¬ìš©ìì˜ ê¸°ìˆ  ìŠ¤íƒì€?")
```

### Level 2: í‘œì¤€í™”ëœ ì–´ëŒ‘í„° (Standardized Adapter) ğŸ”©

- **ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?**: `VectorStore` ê°ì²´ë¥¼ ì´ˆê¸°í™”í•˜ê±°ë‚˜, ë¬¸ì„œ ì¶”ê°€/ì‚­ì œ ë“± LangChainì˜ `VectorStore` í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ.
- **ë¬´ì—‡ì„ ì‚¬ìš©í•˜ë‚˜?**: `langchain_qdrant.QdrantVectorStore`
- **ì™œ?**: `QdrantClient`ë¥¼ LangChain ìƒíƒœê³„ì— ì—°ê²°í•˜ëŠ” í•„ìˆ˜ì ì¸ "ì ‘ì°©ì œ" ì—­í• ì„ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ `similarity_search`ì™€ ê°™ì€ ë©”ì†Œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ Level 1ì˜ `Retriever` ì‚¬ìš©ë³´ë‹¤ ì¢…ì†ì„±ì´ ë†’ì•„ì§€ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

```python
# âœ… DO: VectorStore ì´ˆê¸°í™” ë° ë¬¸ì„œ ì¶”ê°€/ì‚­ì œ
from langchain_qdrant import QdrantVectorStore

# ì´ˆê¸°í™”
vector_store = QdrantVectorStore(
    client=client,
    collection_name="my_collection",
    embedding=embeddings,
)

# ë¬¸ì„œ ì¶”ê°€ (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
vector_store.add_documents(my_documents)

# ID ê¸°ë°˜ ë¬¸ì„œ ì‚­ì œ (í‘œì¤€ ì¸í„°í˜ì´ìŠ¤)
vector_store.delete(ids=["doc_id_1", "doc_id_2"])
```

### Level 3: ì§ì ‘ SDK ì‚¬ìš© (Direct SDK Access) âš™ï¸

- **ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?**:
  1.  **DB ì´ˆê¸° ì„¤ì •**: ì»¬ë ‰ì…˜ ìƒì„±, ë²¡í„° íŒŒë¼ë¯¸í„°(size, distance) ì„¤ì •, í˜ì´ë¡œë“œ ì¸ë±ìŠ¤ ìƒì„± ë“±. ì´ ì‘ì—…ì€ ë³´í†µ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
  2.  **DB ê³ ìœ  ê¸°ëŠ¥ í™œìš©**: ë©”íƒ€ë°ì´í„° í•„í„°ë¥¼ ì´ìš©í•œ ë³µì¡í•œ ì¡°ê±´ì˜ ë¬¸ì„œ ì‚­ì œ/ìˆ˜ì • ë“± LangChain í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ê°€ ì§€ì›í•˜ì§€ ì•ŠëŠ” Qdrantì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ.
- **ë¬´ì—‡ì„ ì‚¬ìš©í•˜ë‚˜?**: `qdrant_client.QdrantClient`
- **ì™œ?**: DB ê´€ë¦¬ ë° ìµœì í™”, íŠ¹ì • DBì˜ ê°•ë ¥í•œ ê¸°ëŠ¥ì„ í™œìš©í•˜ê¸° ìœ„í•´ ë¶ˆê°€í”¼í•©ë‹ˆë‹¤. ì´ ì½”ë“œëŠ” Qdrantì— ì™„ì „íˆ ì¢…ì†ë©ë‹ˆë‹¤.

```python
from qdrant_client import QdrantClient
from qdrant_client.http.models import VectorParams, Distance, PayloadSchemaType

client = QdrantClient(...)

# âœ… DO: ì»¬ë ‰ì…˜ ë° ì¸ë±ìŠ¤ ìƒì„± (ì´ˆê¸° ì„¤ì •)
try:
    client.get_collection("my_collection")
except Exception:
    client.create_collection(
        collection_name="my_collection",
        vectors_config=VectorParams(size=768, distance=Distance.COSINE),
    )
    client.create_payload_index(
        collection_name="my_collection",
        field_name="metadata.user_id",
        field_schema=PayloadSchemaType.KEYWORD
    )

# âœ… DO: ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ì‚­ì œ (ê³ ê¸‰ ê¸°ëŠ¥)
def delete_docs_by_user(user_id: str):
    filter_condition = Filter(must=[...])
    # client.scroll, client.delete ë¡œì§ ...
    pass
```

## ê¶Œì¥ ì½”ë“œ êµ¬ì¡°

ì¢…ì†ì„±ì„ ëª…í™•íˆ ê´€ë¦¬í•˜ê¸° ìœ„í•´, ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì„ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤.

1.  **`qdrant_setup.py` (ë˜ëŠ” `constants/vector_store.py`ì˜ ì„¤ì • ë¶€ë¶„)**

    - `QdrantClient`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¬ë ‰ì…˜ê³¼ í˜ì´ë¡œë“œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” **ì´ˆê¸° ì„¤ì • ë¡œì§**ì„ ì—¬ê¸°ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

2.  **`qdrant_utils.py`**

    - ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ì‚­ì œ(`delete_docs_by`)ì™€ ê°™ì´ `QdrantClient`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” **Qdrant ì¢…ì†ì ì¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜**ë“¤ì„ ì—¬ê¸°ì— ëª¨ì•„ë‘¡ë‹ˆë‹¤. íŒŒì¼ ì´ë¦„ ìì²´ê°€ "ì—¬ê¸°ëŠ” Qdrant ì¢…ì†ì ì¸ ì½”ë“œ"ë¼ëŠ” ê²ƒì„ ì•Œë ¤ì¤ë‹ˆë‹¤.

3.  **Graph Nodes / ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (`parsing_graph.py`, `resume_chat_graph.py`, etc.)**
    - ì´ê³³ì—ì„œëŠ” Level 1ì˜ `Retriever`ë‚˜ Level 2ì˜ `VectorStore` í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©ì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.
    - Qdrantì˜ ê³ ê¸‰ ê¸°ëŠ¥ì´ í•„ìš”í•  ë•Œë§Œ `qdrant_utils.py`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ `import`í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì´ êµ¬ì¡°ë¥¼ ë”°ë¥´ë©´, ë‚˜ì¤‘ì— ë²¡í„° DBë¥¼ `Chroma`ë‚˜ `FAISS`ë¡œ êµì²´í•´ì•¼ í•  ê²½ìš°, `qdrant_setup.py`ì™€ `qdrant_utils.py` íŒŒì¼ë§Œ ìˆ˜ì •í•˜ë©´ ë˜ë¯€ë¡œ, í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì „í˜€ ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

